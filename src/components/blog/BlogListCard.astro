---
import type { BlogEntry } from "@/types";
import { upperHumanize, plainify, slugify } from "@lib/textConverter";
import {
  FaRegFolder,
  FaRegClock,
  FaHashtag,
  FaRegCalendarAlt,
} from "react-icons/fa";
import readingTime from "@lib/readingTime";
import { formatDate } from "@lib/formatDate";
import { Image } from "astro:assets";
import defaultImage from "@assets/picture.jpg";
import LiquidGlass from "@components/common/LiquidGlassLess.astro";
import PlaceholderImage from "@components/blog/PlaceholderImage.astro";

interface Props {
  entry: BlogEntry;
}

const { entry }: Props = Astro.props;
const { title, description, createdAt, categories, tags, image, imageAlt } = entry.data;
const descriptionLength = 100; // 列表页描述稍短

// 检查是否有自定义图片 - 支持本地图片对象和外部图片URL
const hasLocalImage = !!(image && typeof image === "object" && "src" in image);
const hasExternalImage = !!(image && typeof image === "string");
const hasCustomImage = hasLocalImage || hasExternalImage;
const displayImageAlt = imageAlt || `${title} - 默认图片`;

const entryDate = createdAt ? formatDate(createdAt) : null;
const entryReadingTime = readingTime(entry.body!, 1);
const entryDescription = description?.substring(0, descriptionLength) || "";
---

<!-- 列表页专用卡片：固定高度，优化布局 --><!-- <div class="p-1 h-full rounded-lg"> --><!-- <div class="liquidGlass-effect intersect:animate-fadeUp rounded-lg"></div>
    <div class="liquidGlass-tint intersect:animate-fadeUp rounded-lg"></div>
    <div class="liquidGlass-shine intersect:animate-fadeUp rounded-lg"></div> -->
<LiquidGlass
  heavy
  wrapperClass="dock rounded-lg h-36 md:h-52 my-2 pl-0 hover:scale-[1.01]"
  textClass="h-full"
  animation="fadeRight"
>
  <!-- 水平布局：左侧图片，右侧内容 -->
  <div class="flex h-full">
    <!-- 左侧图片区域：固定宽度，图片自适应填充 -->
    <div
      class="relative w-32 md:w-64 h-full flex-shrink-0 overflow-hidden rounded-[25px] group"
    >
      <a href={`/blog/${entry.id}`}>
        {hasCustomImage ? (
          hasLocalImage ? (
            // 本地图片处理
            <Image
              class="w-full h-full rounded-lg object-cover transition-all duration-500 group-hover:scale-110 group-hover:brightness-110"
              src={image}
              alt={displayImageAlt}
              inferSize={true}
              loading="lazy"
              format="webp"
              quality={40}
              decoding="async"
              fetchpriority="high"
            />
          ) : (
            // 外部图片URL处理
            <img
              class="w-full h-full rounded-lg object-cover transition-all duration-500 group-hover:scale-110 group-hover:brightness-110"
              src={image as string}
              alt={displayImageAlt}
              loading="lazy"
              decoding="async"
            />
          )
        ) : (
          <div class="w-full h-full transition-all duration-500 group-hover:scale-110">
            <PlaceholderImage 
              title={title}
              className="w-full h-full rounded-lg"
            />
          </div>
        )}
        <!-- 图片遮罩层 -->
        <div
          class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 rounded-lg group-hover:rounded-xl transition-opacity duration-300"
        >
        </div>
      </a>
    </div>

    <!-- 右侧内容区域：自适应宽度 -->
    <div class="flex-1 py-1 px-3 md:px-6 flex flex-col justify-between min-w-0">
      <!-- 上半部分：标题和元信息 -->
      <div class="flex-1">
        <!-- 文章标题：限制行数 -->
        <h4
          class="mb-2 text-xl font-bold text-gray-900 !line-clamp-2 leading-tight"
        >
          <a
            href={`/blog/${entry.id}`}
            class="hover:text-primary transition-colors duration-200 truncate md:whitespace-normal  block"
          >
            {title}
          </a>
        </h4>

        <!-- 元信息：紧凑布局 -->
        <div class="flex flex-wrap items-center gap-6 mb-2">
          {
            categories && (
              <div class="glass-l rounded-md flex items-center text-gray-600 hover:text-primary transition-colors">
                {categories.slice(0, 2).map(
                  (category: string | undefined, index: number) =>
                    category && (
                      <a
                        href={`/blog/categories/${slugify(category)}`}
                        class="flex items-center px-1.5 py-0.5 hover:bg-primary/10 transition-colors duration-200 dark:text-darkmode-txt-light"
                      >
                        <FaRegFolder className="mr-1 text-xs" />
                        <span class="font-medium text-xs">
                          {upperHumanize(category)}
                        </span>
                      </a>
                    ),
                )}
                {categories.length > 2 && (
                  <span class="text-gray-400 ml-1">
                    +{categories.length - 2}
                  </span>
                )}
              </div>
            )
          }
          {
            (
              <div class="items-center text-gray-500 hidden md:flex">
                <FaRegClock className="mr-1 text-xs dark:text-darkmode-txt-light" />
                <span class="font-medium text-xs dark:text-darkmode-txt-light">
                  {entryReadingTime}
                </span>
              </div>
            )
          }
          {
            entryDate && (
              <div class="flex items-center text-gray-500">
                <FaRegCalendarAlt className="mr-1 text-xs dark:text-darkmode-txt-s" />
                <span class="font-medium text-xs dark:text-darkmode-txt-s">
                  {entryDate}
                </span>
              </div>
            )
          }
        </div>

        <!-- 文章描述：限制行数 -->
        <p
          class="!line-clamp-2 leading-relaxed text-txt-light dark:text-darkmode-txt-light hidden md:flex text-sm md:text-base"
        >
          {entryDescription}
        </p>
      </div>

      <!-- 下半部分：阅读更多按钮 -->
      <div class="mt-2 pt-2 hidden md:flex">
        <a
          href={`/blog/${entry.id}`}
          class="inline-flex items-center text-primary hover:text-primary-dark font-medium text-xs transition-colors duration-200 group"
        >
          <span>阅读全文</span>
          <svg
            class="ml-1 w-3 h-3 transition-transform duration-200 group-hover:translate-x-1"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"></path>
          </svg>
        </a>
      </div>
    </div>
  </div>
</LiquidGlass>
<!-- </div> -->


